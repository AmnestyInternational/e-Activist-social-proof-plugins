/*!
 * Engaging Networks (E-Activist and Netdonor) thermometer plugin for jQuery
 * Copyright (c) 2011 Dave Cranwell (http://davecranwell.com / @davecranwell)
 * Extended 2012 by Adam Lofting (http://adamlofting.com / @adamlofting)
 * Licensed under the MIT License.
 * 2011-09-05
 * version 1.1.0
 */
(function(a){a.fn.eActivistThermometer=function(b){function d(a){return Math.max(0,a).toFixed(0).replace(/(?=(?:\d{3})+$)(?!^)/g,",")}var c={token:"",campaigId:0,target:0,duration:2e3,dataUrl:"",initialValue:0,service:"EaEmailAOTarget",currency_symbol:""};return this.each(function(){var e=a(this);if(b){a.extend(c,b)}if(c.dataUrl.length){dataUrl=c.dataUrl}else{dataUrl="http://e-activist.com/ea-dataservice/data.service?service="+c.service+"&resultType=summary&contentType=json&token="+c.token+"&campaignId="+c.campaignId+"&callback=?"}a.get(dataUrl,function(b){if(c.service=="NetDonor"){targetDataColumn="total amount donated"}else{targetDataColumn="registrations"}var f=-1;for(j=0;j<b.rows[0].columns.length;j++){if(b.rows[0].columns[j].name.toLowerCase()==targetDataColumn){f=j}}var g=c.initialValue;for(i=0;i<b.rows.length;i++){g+=parseInt(b.rows[i].columns[f].value)}var h=a(".t_body",e).width();var k=Math.ceil(g/parseInt(c.target)*100/1);if(k>100)k=100;var l=Math.ceil(parseInt(k)/100*h/1);if(l<h/2){a(".t_body .t_current",e).removeClass("inner")}else{a(".t_body .t_current",e).addClass("inner")}a(".t_target",e).html(c.currency_symbol+d(c.target));a(".t_current",e).html(c.currency_symbol+d(g)+" ");if(c.duration){var m=1;var n=setInterval(function(){m=parseInt(m)+Math.ceil(g/c.duration*100);if(m>=g){m=g;clearInterval(n)}a(".t_body .t_current",e).html(c.currency_symbol+d(m))},100);a(".t_level",e).animate({width:k+"%"},c.duration,function(){})}else{a(".t_level",e).css("width",k+"%")}},"json")})}})(jQuery)