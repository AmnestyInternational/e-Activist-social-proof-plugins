/*!
  E-Activist campaign supporter list plugin for jQuery
  Copyright (c) 2011 Dave Cranwell (http://davecranwell.com / @davecranwell)
  Licensed under the MIT License.
  2011-12-13
  version 1.1.2
 */Date.prototype.isDST=function(){var a=this.getTimezoneOffset();var b=new Date;var c=0;while(c<12){b.setMonth(++c);if(b.getTimezoneOffset()>a)return true;if(b.getTimezoneOffset()<a)return false}return false};(function(a){a.fn.eActivistSupporterlist=function(b){function d(a){var b=a.toLowerCase();return b.charAt(0).toUpperCase()+b.slice(1)}var c={token:"",campaignId:0,count:5,format:"{forenames} from {town}, {datetime} {ago}",agoFormat:"datetime",agoText:"ago",agoFormatLabelsSingular:["year","month","week","day","hour","minute","second"],agoFormatLabelsPlural:["years","months","weeks","days","hours","minutes","seconds"],dataUrl:""};return this.each(function(){var d=a(this);if(b){a.extend(c,b)}var e=c.format.match(/\{[^/}]*\}/g);if(c.dataUrl.length){dataUrl=c.dataUrl}else{dataUrl="http://e-activist.com/ea-dataservice/data.service?service=EaEmailAOTarget&startRow=0&endRow="+c.count+"&contentType=json&token="+c.token+"&campaignId="+c.campaignId+"&callback=?"}a.getJSON(dataUrl,function(b){var f=new Date;var g=new Date(f.getUTCFullYear(),f.getUTCMonth(),f.getUTCDate(),f.getUTCHours(),f.getUTCMinutes(),f.getUTCSeconds());if(b.rows.length){var h=a("<ul></ul>");for(i=0;i<b.rows.length;i++){var k=c.format;for(x=0;x<e.length;x++){var l=e[x].replace(/\{|\}/g,"").toLowerCase();var m="";for(j=0;j<b.rows[i].columns.length;j++){if(b.rows[i].columns[j].name.toLowerCase()==l){m=b.rows[i].columns[j].value}}if(l=="ago"){m=c.agoText}if(l==c.agoFormat){var n=Date.parse(m.replace(/\-/g,"/").replace(/[^0-9\/\:]/g," "));if((new Date(n)).isDST()){n-=60*60*1e3}var o=0;var p=Math.floor((g-n)/1e3);var q=Math.floor(p/60);var r=Math.floor(q/60);var s=Math.floor(r/24);var t=Math.floor(s/7);var u=Math.floor(s/30);var v=Math.floor(s/365);if(v>1){o=v;formatLabel=0}else if(u>1){o=u;formatLabel=1}else if(t>1){o=t;formatLabel=2}else if(s>1){o=s;formatLabel=3}else if(r>1){o=r;formatLabel=4}else if(q>1){o=q;formatLabel=5}else{o=p;formatLabel=6}m=String(o)+" "+(o!=1?c.agoFormatLabelsPlural[formatLabel]:c.agoFormatLabelsSingular[formatLabel])}k=k.replace(e[x],m)}h.append(a("<li>"+k+"</li>"))}d.append(h)}},"json")})}})(jQuery)