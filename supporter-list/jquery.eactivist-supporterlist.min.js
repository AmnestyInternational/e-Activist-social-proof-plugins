/*!
 * E-Activist campaign supporter list plugin for jQuery
 * Copyright (c) 2011 Dave Cranwell (http://davecranwell.com / @davecranwell)
 * Licensed under the MIT License.
 * 2011-12-13
 * version 1.1.2
 */
Date.prototype.isDST=function(){var c=this.getTimezoneOffset();var b=new Date();var a=0;while(a<12){b.setMonth(++a);if(b.getTimezoneOffset()>c){return true}if(b.getTimezoneOffset()<c){return false}}return false};(function(a){a.fn.eActivistSupporterlist=function(b){var c={token:"",campaignId:0,count:5,format:"{forenames} from {town}, {datetime} {ago}",agoFormat:"datetime",agoText:"ago",agoFormatLabelsSingular:["year","month","week","day","hour","minute","second"],agoFormatLabelsPlural:["years","months","weeks","days","hours","minutes","seconds"],dataUrl:""};function d(e){var f=e.toLowerCase();return f.charAt(0).toUpperCase()+f.slice(1)}return this.each(function(){var f=a(this);if(b){a.extend(c,b)}var e=c.format.match(/\{[^/}]*\}/g);if(c.dataUrl.length){dataUrl=c.dataUrl}else{dataUrl="http://e-activist.com/ea-dataservice/data.service?service=EaEmailAOTarget&startRow=0&endRow="+c.count+"&contentType=json&token="+c.token+"&campaignId="+c.campaignId+"&callback=?"}a.getJSON(dataUrl,function(p){var v=new Date();var o=new Date(v.getUTCFullYear(),v.getUTCMonth(),v.getUTCDate(),v.getUTCHours(),v.getUTCMinutes(),v.getUTCSeconds());if(p.rows.length){var t=a("<ul></ul>");for(i=0;i<p.rows.length;i++){var n=c.format;for(x=0;x<e.length;x++){var s=e[x].replace(/\{|\}/g,"").toLowerCase();var m="";for(j=0;j<p.rows[i].columns.length;j++){if(p.rows[i].columns[j].name.toLowerCase()==s){m=p.rows[i].columns[j].value}}if(s=="ago"){m=c.agoText}if(s==c.agoFormat){var u=Date.parse(m.replace(/\-/g,"/").replace(/[^0-9\/\:]/g," "));if(new Date(u).isDST()){u-=(60*60*1000)}var l=0;var q=Math.floor((o-u)/1000);var k=Math.floor(q/60);var y=Math.floor(k/60);var w=Math.floor(y/24);var g=Math.floor(w/7);var h=Math.floor(w/30);var r=Math.floor(w/365);if(r>1){l=r;formatLabel=0}else{if(h>1){l=h;formatLabel=1}else{if(g>1){l=g;formatLabel=2}else{if(w>1){l=w;formatLabel=3}else{if(y>1){l=y;formatLabel=4}else{if(k>1){l=k;formatLabel=5}else{l=q;formatLabel=6}}}}}}m=String(l)+" "+((l!=1)?c.agoFormatLabelsPlural[formatLabel]:c.agoFormatLabelsSingular[formatLabel])}n=n.replace(e[x],m)}t.append(a("<li>"+n+"</li>"))}f.append(t)}},"json")})}})(jQuery);