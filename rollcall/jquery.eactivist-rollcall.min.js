/*!
 * E-Activist 'Roll-call' plugin for jQuery
 * By Adam Lofting (http://adamlofting.com / @adamlofting)
 * Based on the jquery.eactivist-supporterlist by Dave Cranwell (http://davecranwell.com / @davecranwell)
 * - Works with NetDonor for latest donation amount
 * - Lighter than eactivist-supporterlist if you don't need time of signatures
 * Licensed under the MIT License.
 * 2012-08-27
 * version 1.1.0
 */
(function(a){a.fn.eActivistRollcall=function(b){function d(a){var b=a.toLowerCase();return b.charAt(0).toUpperCase()+b.slice(1)}function e(){return Math.round(Math.random())-.5}var c={token:"",campaignId:0,format:"{firstName} from {country}{city} gave {currency}{amount}",dataUrl:"",dataSet:1,count:5,service:"RollCall",titleCaseFields:["firstname","city","country"],currencySymbolReplacements:{GBP:"&#163;",EUR:"&#8364;"}};return this.each(function(){var f=a(this);if(b){a.extend(c,b)}var g=c.format.match(/\{[^/}]*\}/g);if(c.dataUrl.length){dataUrl=c.dataUrl}else{dataUrl="http://e-activist.com/ea-dataservice/data.service?service="+c.service+"&dataSet="+c.dataSet+"&contentType=json&token="+c.token+"&campaignId="+c.campaignId+"&callback=?"}a.getJSON(dataUrl,function(b){if(b.rows.length){var h=a("<ul></ul>");b.rows.sort(e);for(i=0;i<b.rows.length;i++){if(i<c.count){var k=c.format;for(x=0;x<g.length;x++){var l=g[x].replace(/\{|\}/g,"").toLowerCase();var m="";for(j=0;j<b.rows[i].columns.length;j++){if(b.rows[i].columns[j].name.toLowerCase()==l){m=b.rows[i].columns[j].value}}if(l=="currency"){if(m in c.currencySymbolReplacements){m=c.currencySymbolReplacements[m]}}if(a.inArray(l,c.titleCaseFields)>=0){m=d(m)}k=k.replace(g[x],m)}h.append(a("<li>"+k+"</li>"))}}f.append(h)}},"json")})}})(jQuery)