/*!
 * E-Activist 'Roll-call' plugin for jQuery
 * By Adam Lofting (http://adamlofting.com / @adamlofting)
 * Based on the jquery.eactivist-supporterlist by Dave Cranwell (http://davecranwell.com / @davecranwell)
 * - Works with NetDonor for latest donation amount
 * - Lighter than eactivist-supporterlist if you don't need time of signatures
 * Licensed under the MIT License.
 * 2012-08-27
 * version 1.0.1
 */
(function(a){a.fn.eActivistRollcall=function(b){var c={token:"",campaignId:0,format:"{firstName} from {country}{city} gave {currency}{amount}",dataUrl:"",dataSet:1,count:5,service:"RollCall",titleCaseFields:["firstname","city","country"],currencySymbolReplacements:{GBP:"&#163;",EUR:"&#8364;"}};function d(e){var f=e.toLowerCase();return f.charAt(0).toUpperCase()+f.slice(1)}return this.each(function(){var f=a(this);if(b){a.extend(c,b)}var e=c.format.match(/\{[^/}]*\}/g);if(c.dataUrl.length){dataUrl=c.dataUrl}else{dataUrl="http://e-activist.com/ea-dataservice/data.service?service="+c.service+"&dataSet="+c.dataSet+"&contentType=json&token="+c.token+"&campaignId="+c.campaignId+"&callback=?"}a.getJSON(dataUrl,function(m){if(m.rows.length){var l=a("<ul></ul>");for(i=0;i<m.rows.length;i++){if(i<c.count){var h=c.format;for(x=0;x<e.length;x++){var g=e[x].replace(/\{|\}/g,"").toLowerCase();var k="";for(j=0;j<m.rows[i].columns.length;j++){if(m.rows[i].columns[j].name.toLowerCase()==g){k=m.rows[i].columns[j].value}}if(g=="currency"){if(k in c.currencySymbolReplacements){k=c.currencySymbolReplacements[k]}}if(a.inArray(g,c.titleCaseFields)>=0){k=d(k)}h=h.replace(e[x],k)}l.append(a("<li>"+h+"</li>"))}}f.append(l)}},"json")})}})(jQuery);