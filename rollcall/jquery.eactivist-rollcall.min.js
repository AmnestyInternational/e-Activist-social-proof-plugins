/*!
 * E-Activist 'Roll-call' plugin for jQuery
 * By Adam Lofting (http://adamlofting.com / @adamlofting)
 * Based on the jquery.eactivist-supporterlist by Dave Cranwell (http://davecranwell.com / @davecranwell)
 * - Works with NetDonor for latest donation amount
 * - Lighter than eactivist-supporterlist if you don't need time of signatures
 * Licensed under the MIT License.
 * 2012-08-27
 * version 1.0.0
 */
(function(a){a.fn.eActivistRollcall=function(b){function d(a){var b=a.toLowerCase();return b.charAt(0).toUpperCase()+b.slice(1)}var c={token:"",campaignId:0,format:"{firstName} from {country}{city} gave {currency}{amount}",dataUrl:"",dataSet:1,count:5,service:"RollCall",fields_to_format:["firstname","city","country"],currency_symbols_to_replace:{GBP:"&#163;",EUR:"&#8364;"}};return this.each(function(){var e=a(this);if(b){a.extend(c,b)}var f=c.format.match(/\{[^/}]*\}/g);if(c.dataUrl.length){dataUrl=c.dataUrl}else{dataUrl="http://e-activist.com/ea-dataservice/data.service?service="+c.service+"&dataSet="+c.dataSet+"&contentType=json&token="+c.token+"&campaignId="+c.campaignId+"&callback=?"}a.getJSON(dataUrl,function(b){if(b.rows.length){var g=a("<ul></ul>");for(i=0;i<b.rows.length;i++){if(i<c.count){var h=c.format;for(x=0;x<f.length;x++){var k=f[x].replace(/\{|\}/g,"").toLowerCase();var l="";for(j=0;j<b.rows[i].columns.length;j++){if(b.rows[i].columns[j].name.toLowerCase()==k){l=b.rows[i].columns[j].value}}if(k=="currency"){if(l in c.currency_symbols_to_replace){l=c.currency_symbols_to_replace[l]}}if(a.inArray(k,c.fields_to_format)>=0){l=d(l)}h=h.replace(f[x],l)}g.append(a("<li>"+h+"</li>"))}}e.append(g)}},"json")})}})(jQuery)